name: version-bump
on:
  workflow_dispatch:
    inputs:
      formula:
        description: 'Formula to update'
        required: true
        type: string

jobs:
  update-formula:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout source
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: diff version
        run: |
          curl -L https://milpa.dev/install.sh | bash -
          cp "$FORMULA" /tmp/before.rb
          milpa version-bump "$FORMULA"
          diff -u /tmp/before.rb "$FORMULA"
        env:
          FORMULA: ${{ inputs.formula }}
